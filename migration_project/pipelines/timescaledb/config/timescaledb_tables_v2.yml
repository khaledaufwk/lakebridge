# TimescaleDB Table Registry - Version 2.2 (Performance Optimized)
# ================================================
# Generated: 2026-01-21
# Updated: 2026-01-26
# Source: wakecap_app database
#
# IMPROVEMENTS IN THIS VERSION:
# 1. Uses GREATEST(CreatedAt, UpdatedAt, DeletedAt) for comprehensive change tracking
# 2. Excludes tables with complex JSON/binary data types
# 3. Properly handles geometry columns with ST_AsText
# 4. Optimized batch sizes for large tables
# 5. [2.2] Append-only mode for insert-only hypertables (DeviceLocation, etc.)
# 6. [2.2] Optimized batch/fetch sizes for large tables (3M+ rows)
# 7. [2.2] Parallel loading support in loader
# ================================================

registry_version: '2.2'
source_system: timescaledb
source_database: wakecap_app
target_catalog: wakecap_prod
target_schema: raw
generated_date: '2026-01-21'
description: TimescaleDB bronze layer - optimized incremental load with GREATEST watermark

defaults:
  source_schema: public
  watermark_type: timestamp
  load_mode: incremental
  merge_strategy: upsert
  fetch_size: 50000
  batch_size: 100000
  enabled: true

connection:
  secret_scope: wakecap-timescale
  driver: org.postgresql.Driver
  ssl_mode: require

metadata_columns:
  - name: _loaded_at
    expression: current_timestamp()
  - name: _source_system
    expression: "'timescaledb'"
  - name: _source_table
    expression: source_table_name

# ============================================
# EXCLUDED TABLES
# ============================================
# Two categories of exclusions:
# 1. Complex JSON/binary types - not suitable for analytics
# 2. Performance optimization - large tables with no Gold layer dependencies
#
excluded_tables:
  # --- Complex JSON/Binary Types ---
  - source_table: AuditTrail
    reason: "Contains complex JSON in Changes column - audit/logging table, not needed for analytics"
    enabled: false

  - source_table: MobileSyncRejectedActions
    reason: "Contains complex JSON payload - sync debugging table"
    enabled: false

  - source_table: SGSAttendanceLogDebug
    reason: "Debug/logging table with complex JSON structures"
    enabled: false

  - source_table: SGSIntegrationLog
    reason: "Integration logging table with complex payloads"
    enabled: false

  - source_table: BulkUploadBatch
    reason: "Contains binary file data and complex JSON"
    enabled: false

  # --- Performance Optimization (Large tables, no Gold dependencies) ---
  # These tables can be loaded on-demand using a separate job if needed
  - source_table: SGSRosterWorkshiftLog
    reason: "71M rows, 17GB - External SGS roster data, no Gold layer dependencies. Saves ~25 min/run."
    rows: 71000000
    size_gb: 17
    enabled: false

  - source_table: ViewFactWorkshiftsCache
    reason: "9.5M rows, 2.7GB - Pre-computed cache, redundant with Gold calculations. Saves ~5 min/run."
    rows: 9500000
    size_gb: 2.7
    enabled: false

# ============================================
# DIMENSION TABLES
# ============================================
tables:
  # --- Core Dimensions ---
  - source_table: Activity
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: Company
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: CompanyType
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    category: dimensions
    is_full_load: true  # Small reference table

  - source_table: Crew
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'), COALESCE(\"DeletedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: CrewComposition
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: CrewManager
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: CrewProductivityStatus
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    category: dimensions
    is_full_load: true

  - source_table: CrewType
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    category: dimensions
    is_full_load: true

  - source_table: DataGroup
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: DelayReason
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: Department
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: Discipline
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    category: dimensions
    is_full_load: true

  - source_table: Equipment
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: EquipmentType
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    category: dimensions
    is_full_load: true

  - source_table: ExpiryDuration
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    category: dimensions
    is_full_load: true

  - source_table: LocationGroup
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: Nationality
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    category: dimensions
    is_full_load: true

  - source_table: OBS
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: OBSCurrent
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    category: dimensions

  - source_table: Package
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: People
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'), COALESCE(\"DeletedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: PeopleTitle
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    category: dimensions
    is_full_load: true

  - source_table: RegistrationType
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    category: dimensions
    is_full_load: true

  - source_table: Trade
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: Training
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: WorkArea
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: Workshift
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: WorkshiftDay
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: WorkshiftSchedule
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  - source_table: WorkshiftScheduleBreak
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    category: dimensions

  - source_table: ZoneCategory
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    category: dimensions
    is_full_load: true

  # --- Geometry Tables (require ST_AsText conversion) ---
  - source_table: Blueprint
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions
    has_geometry: true
    geometry_columns: [Geometry]
    custom_query: |
      SELECT *, ST_AsText("Geometry") as "GeometryWKT"
      FROM "public"."Blueprint"
      WHERE GREATEST(COALESCE("CreatedAt", '1900-01-01'), COALESCE("UpdatedAt", '1900-01-01')) > '{watermark}'

  - source_table: Space
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions
    has_geometry: true
    geometry_columns: [Geometry]
    custom_query: |
      SELECT *, ST_AsText("Geometry") as "GeometryWKT"
      FROM "public"."Space"
      WHERE GREATEST(COALESCE("CreatedAt", '1900-01-01'), COALESCE("UpdatedAt", '1900-01-01')) > '{watermark}'

  - source_table: Zone
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions
    has_geometry: true
    geometry_columns: [Geometry]
    custom_query: |
      SELECT *, ST_AsText("Geometry") as "GeometryWKT"
      FROM "public"."Zone"
      WHERE GREATEST(COALESCE("CreatedAt", '1900-01-01'), COALESCE("UpdatedAt", '1900-01-01')) > '{watermark}'

  # --- Device Tables ---
  - source_table: AvlDevice
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: dimensions

  # --- Assignment/Bridge Tables ---
  - source_table: AssignedWorkshiftAttendanceScope
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: assignments

  - source_table: CalendarPeriod
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: assignments

  - source_table: Certificate
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: assignments

  - source_table: CertificateType
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    category: assignments
    is_full_load: true

  - source_table: EquipmentCertificatesTypes
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    category: assignments

  - source_table: EquipmentOperators
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: assignments

  - source_table: LocationGroupZone
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: assignments

  # ManualLocationAssignment - Large assignment table (1.4M+ rows)
  - source_table: ManualLocationAssignment
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: assignments
    fetch_size: 50000
    batch_size: 200000
    is_full_load: false
    comment: "Large assignment table - 1.4M rows"

  - source_table: PermitActivity
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: assignments

  - source_table: ProgressDataGroup
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: assignments

  - source_table: ProgressDelayReason
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: assignments

  - source_table: ResourceDevice
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: assignments

  - source_table: TrainingSession
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: assignments

  # TrainingSessionTrainee - Large assignment table (337K+ rows)
  - source_table: TrainingSessionTrainee
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: assignments
    fetch_size: 50000
    batch_size: 200000
    is_full_load: false
    comment: "Large assignment table - 337K rows"

  - source_table: WorkPermit
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: assignments

  - source_table: WorkPermitActivity
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: assignments

  # WorkshiftResourceAssignment - Large assignment table (3.4M+ rows)
  # OPTIMIZATION: Increased batch/fetch sizes for faster loading
  - source_table: WorkshiftResourceAssignment
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: assignments
    fetch_size: 100000
    batch_size: 200000
    comment: "Large table - 3.4M rows, optimized batch sizes"

  - source_table: ZoneAuthorizedResource
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: assignments

  # --- Fact Tables (Large, with optimized settings) ---
  # AttendanceReportConsalidatedDay - Large fact table (85K+ rows)
  - source_table: AttendanceReportConsalidatedDay
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: facts
    fetch_size: 50000
    batch_size: 200000
    is_full_load: false
    comment: "Large fact table - 85K rows, incremental loading"

  - source_table: Co2Inspection
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: facts

  # DeviceLocation - Large hypertable (82M rows, 52GB)
  # Partitioned by GeneratedAt (14-day chunks)
  # Note: UpdatedAt is NULL for all rows, so we use GeneratedAt directly
  # OPTIMIZATION: Using append-only mode since this is an insert-only hypertable
  - source_table: DeviceLocation
    primary_key_columns: [DeviceId, ProjectId, ActiveSequance, InactiveSequance, GeneratedAt]
    watermark_column: GeneratedAt
    # No GREATEST needed - GeneratedAt is the definitive timestamp and never null
    category: facts
    has_geometry: true
    geometry_columns: [Point]
    fetch_size: 100000
    batch_size: 500000
    is_hypertable: true
    is_append_only: true  # CRITICAL: Skip MERGE, use APPEND for ~4x faster loads
    comment: "Large hypertable - ~50M rows/month, append-only (no updates)"

  # DeviceLocationSummary - Daily aggregated hypertable (848K rows, 3.8GB)
  # Partitioned by Day (30-day chunks)
  # OPTIMIZATION: Using append-only mode since this is an insert-only hypertable
  - source_table: DeviceLocationSummary
    primary_key_columns: [Day, DeviceId, ProjectId]
    watermark_column: GeneratedAt
    # Use GeneratedAt for consistency with DeviceLocation
    category: facts
    has_geometry: true
    geometry_columns: [Point, ConfidenceArea]
    fetch_size: 50000
    batch_size: 200000
    is_hypertable: true
    is_append_only: true  # CRITICAL: Skip MERGE, use APPEND for faster loads
    comment: "Daily summary hypertable - ~400K rows/month, append-only"

  # EquipmentTelemetry - Large telemetry table (3M+ rows)
  # FIXED: PK is composite (EquipmentId, Id) not just (Id)
  - source_table: EquipmentTelemetry
    primary_key_columns: [EquipmentId, Id]  # Correct composite PK from database
    watermark_column: CreatedAt
    category: facts
    fetch_size: 100000
    batch_size: 500000
    is_hypertable: true
    is_append_only: true  # Telemetry data is insert-only

  - source_table: Inspection
    primary_key_columns: [Id]
    watermark_column: CreatedAt
    category: facts
    is_append_only: true  # Uses only CreatedAt - insert-only pattern

  - source_table: Plan
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: facts

  - source_table: PlanProgress
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: facts

  - source_table: PlanProgressDelayReason
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: facts

  - source_table: PlanProgressResource
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: facts

  - source_table: ResourceApprovedHour
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: facts

  - source_table: ResourceApprovedHoursSegment
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: facts

  # ResourceAttendance - Large fact table (1.4M+ rows)
  # OPTIMIZATION: Increased batch/fetch sizes for faster loading
  - source_table: ResourceAttendance
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: facts
    fetch_size: 100000
    batch_size: 200000
    comment: "Large table - 1.4M rows, optimized batch sizes"

  # ResourceHours - Large fact table (3.3M+ rows)
  # OPTIMIZATION: Increased batch/fetch sizes for faster loading
  - source_table: ResourceHours
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: facts
    fetch_size: 100000
    batch_size: 200000
    comment: "Large table - 3.3M rows, optimized batch sizes"

  # ResourceTimesheet - Large fact table (2.7M+ rows)
  # OPTIMIZATION: Increased batch/fetch sizes for faster loading
  - source_table: ResourceTimesheet
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: facts
    fetch_size: 100000
    batch_size: 200000
    comment: "Large table - 2.7M rows, optimized batch sizes"

  - source_table: ResourceZone
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: facts
    fetch_size: 100000
    batch_size: 500000

  - source_table: SGSAttendanceLog
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: facts

  # SGSRosterWorkshiftLog - Large table (71M+ rows)
  # EXCLUDED: No Gold layer dependencies, external SGS roster data
  # Can be loaded on-demand if needed for roster reconciliation
  # Savings: ~20-25 min per job run (largest table)
  - source_table: SGSRosterWorkshiftLog
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: facts
    fetch_size: 100000
    batch_size: 500000
    is_full_load: false
    enabled: false  # EXCLUDED - no Gold layer impact, 71M rows
    comment: "EXCLUDED - Large table (71M rows), no Gold dependencies. Load on-demand if needed."

  # ViewFactWorkshiftsCache - Pre-aggregated cache table (9.5M rows)
  # EXCLUDED: Pre-computed cache, likely redundant with Gold layer calculations
  # Can be loaded on-demand if needed for performance comparison
  - source_table: ViewFactWorkshiftsCache
    primary_key_columns: [ProjectId, ExtWorkerID, ShiftLocalDate]  # Fixed column order to match DB
    watermark_column: WatermarkUTC
    category: facts
    fetch_size: 100000
    batch_size: 500000
    is_hypertable: true
    is_full_load: false
    is_append_only: true
    enabled: false  # EXCLUDED - pre-computed cache, 9.5M rows
    comment: "EXCLUDED - Pre-aggregated cache (9.5M rows), redundant with Gold layer. Load on-demand if needed."

  # --- History Tables (Geometry with ST_AsText) ---
  - source_table: SpaceHistory
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: history
    has_geometry: true
    geometry_columns: [Geometry]

  - source_table: ZoneHistory
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: history
    has_geometry: true
    geometry_columns: [Geometry]

  - source_table: ZoneViolationLog
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: history
    has_geometry: true
    geometry_columns: [Geometry]

  - source_table: NovadeWorkPermit
    primary_key_columns: [Id]
    watermark_column: UpdatedAt
    watermark_expression: "GREATEST(COALESCE(\"CreatedAt\", '1900-01-01'), COALESCE(\"UpdatedAt\", '1900-01-01'))"
    category: facts
    has_geometry: true
    geometry_columns: [Geometry]
